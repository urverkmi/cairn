<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Drawing Board</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0;
        }
        #instructions {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255,255,255,0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="instructions">
        Draw by dragging mouse or finger. Trail will be tracked.
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas to full window size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Trail tracking variables
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        const trail = [];
        const MAX_TRAIL_LENGTH = 50; // Maximum number of points to store
        const TURN_THRESHOLD = 15; // Minimum angle change to log as a turning point

        // Calculate angle between three points
        function calculateAngle(p1, p2, p3) {
            const v1 = { x: p1.x - p2.x, y: p1.y - p2.y };
            const v2 = { x: p3.x - p2.x, y: p3.y - p2.y };
            
            const dotProduct = v1.x * v2.x + v1.y * v2.y;
            const v1Mag = Math.sqrt(v1.x * v1.x + v1.y * v1.y);
            const v2Mag = Math.sqrt(v2.x * v2.x + v2.y * v2.y);
            
            const cosAngle = dotProduct / (v1Mag * v2Mag);
            return Math.acos(Math.max(-1, Math.min(1, cosAngle))) * 180 / Math.PI;
        }

        function startDrawing(x, y) {
            isDrawing = true;
            [lastX, lastY] = [x, y];
            trail.length = 0; // Clear previous trail
            trail.push({ x, y, timestamp: Date.now() });
        }

        function draw(x, y) {
            if (!isDrawing) return;

            // Draw line
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.strokeStyle = 'blue';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.stroke();

            // Track trail
            trail.push({ x, y, timestamp: Date.now() });

            // Limit trail length
            if (trail.length > MAX_TRAIL_LENGTH) {
                trail.shift();
            }

            // Check for turning points
            if (trail.length >= 3) {
                const lastThreePoints = trail.slice(-3);
                const angle = calculateAngle(
                    lastThreePoints[0], 
                    lastThreePoints[1], 
                    lastThreePoints[2]
                );

                // Log turning points with significant angle change
                if (angle > TURN_THRESHOLD) {
                    console.log('Turning Point:', lastThreePoints[1]);
                }
            }

            // Update last position
            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            isDrawing = false;
            console.log('Final Trail:', trail);
        }

        // Mouse event listeners
        canvas.addEventListener('mousedown', (e) => {
            startDrawing(e.clientX, e.clientY);
        });

        canvas.addEventListener('mousemove', (e) => {
            draw(e.clientX, e.clientY);
        });

        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch event listeners for mobile support
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            startDrawing(touch.clientX, touch.clientY);
        }, { passive: false });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            draw(touch.clientX, touch.clientY);
        }, { passive: false });

        canvas.addEventListener('touchend', stopDrawing);
    </script>
</body>
</html>