<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Clock Characters</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        .buttons { 
            position: fixed; 
            bottom: 20px; 
            width: 100%; 
            text-align: center; 
            z-index: 10; 
        }
    </style>
</head>
<body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        <!-- Marker -->
        <a-marker preset="hiro">
            <a-entity id="clock-container">
                <!-- Clock content will be dynamically added here -->
            </a-entity>
        </a-marker>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // P5.js sketch for clock characters
        let characters = [];
        let targetHands = [];
        let isAnimating = false;
        let canvas;

        function setup() {
            canvas = createCanvas(300, 300);
            canvas.parent('clock-container');
            textAlign(CENTER, CENTER);
            textSize(20);

            // Generate initial random characters
            for (let i = 0; i < 300; i++) {
                characters.push({
                    x: random(width),
                    y: random(height),
                    char: char(int(random(33, 126))),
                    color: color(random(255), random(255), random(255))
                });
            }
        }

        function draw() {
            clear();

            // Draw scattered characters
            characters.forEach(char => {
                fill(char.color);
                text(char.char, char.x, char.y);
            });

            // Animation logic
            if (isAnimating) {
                characters = characters.map((char, index) => {
                    if (index < targetHands.length) {
                        const target = targetHands[index];
                        char.x = lerp(char.x, target.x, 0.1);
                        char.y = lerp(char.y, target.y, 0.1);
                    }
                    return char;
                });

                // Check if animation is complete
                const allReached = characters.every((char, index) => 
                    index >= targetHands.length || 
                    (abs(char.x - targetHands[index].x) < 1 && 
                     abs(char.y - targetHands[index].y) < 1)
                );

                if (allReached) {
                    isAnimating = false;
                }
            }
        }

        // Function to trigger clock animation
        function triggerClockAnimation() {
            if (!isAnimating) {
                const now = new Date();
                const hours = now.getHours() % 12;
                const minutes = now.getMinutes();

                const centerX = width / 2;
                const centerY = height / 2;
                
                // Hour hand
                const hourAngle = map(hours + minutes / 60, 0, 12, 0, TWO_PI) - HALF_PI;
                const hourLength = 200;
                const hourTimeString = hours.toString().padStart(2, '0');
                
                // Minute hand
                const minuteAngle = map(minutes, 0, 60, 0, TWO_PI) - HALF_PI;
                const minuteLength = 250;
                const minuteTimeString = minutes.toString().padStart(2, '0');

                // Create targets for time digits and additional characters
                const combinedTargets = [
                    // Time digits
                    ...hourTimeString.split('').map((char, index) => ({
                        x: centerX + cos(hourAngle) * (hourLength * (index + 1) / 2),
                        y: centerY + sin(hourAngle) * (hourLength * (index + 1) / 2),
                        char: char
                    })),
                    ...minuteTimeString.split('').map((char, index) => ({
                        x: centerX + cos(minuteAngle) * (minuteLength * (index + 1) / 2),
                        y: centerY + sin(minuteAngle) * (minuteLength * (index + 1) / 2),
                        char: char
                    })),
                    
                    // Additional scattered characters along the hands
                    ...Array.from({length: 50}, () => {
                        const isHourHand = random() < 0.5;
                        const angle = isHourHand ? hourAngle : minuteAngle;
                        const length = isHourHand ? hourLength : minuteLength;
                        
                        const handProgress = random();
                        
                        return {
                            x: centerX + cos(angle) * (length * handProgress),
                            y: centerY + sin(angle) * (length * handProgress),
                            char: char(int(random(33, 126)))
                        };
                    })
                ];

                // Shuffle remaining characters
                const shuffledChars = characters
                    .filter(char => !combinedTargets.some(t => t.char === char.char))
                    .sort(() => 0.5 - random());

                // Combine and distribute all characters
                targetHands = [
                    ...combinedTargets,
                    ...shuffledChars.slice(0, 50).map((char, index) => ({
                        x: centerX + random(-50, 50),
                        y: centerY + random(-50, 50),
                        char: char.char
                    }))
                ];

                // Start animation
                isAnimating = true;
            }
        }

        // Attach event listeners for both mouse and touch
        function attachEventListeners() {
            // For desktop
            document.querySelector('a-scene').addEventListener('click', triggerClockAnimation);
            
            // For mobile touch
            document.querySelector('a-scene').addEventListener('touchstart', triggerClockAnimation);
        }

        // Wait for A-Frame scene to load before attaching listeners
        document.querySelector('a-scene').addEventListener('loaded', attachEventListeners);
    </script>
</body>
</html>